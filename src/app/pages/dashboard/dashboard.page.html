<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Dashboard Meteorológico</ion-title>
    <ion-badge 
      *ngIf="activeAlertsCount > 0"
      color="danger"
      slot="end"
      style="margin-right: 8px;">
      <ion-icon name="warning-outline"></ion-icon>
      {{ activeAlertsCount }}
    </ion-badge>
    <ion-button slot="end" fill="clear" (click)="logout()">
      <ion-icon name="log-out-outline"></ion-icon>
    </ion-button>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="dashboard-container">
    <div class="connection-status">
      <ion-badge [color]="isConnected ? 'success' : 'danger'">
        <ion-icon [name]="isConnected ? 'wifi-outline' : 'alert-circle-outline'"></ion-icon>
        {{ isConnected ? 'Conectado' : 'Desconectado' }}
      </ion-badge>
      <span class="last-update" *ngIf="lastUpdateTime">
        Última atualização: {{ lastUpdateTime }}
      </span>
    </div>

    <div class="current-reading-section" *ngIf="currentReading; else noData">
      <h2 class="section-title">
        <ion-icon name="cloud-outline"></ion-icon>
        Leitura Atual
      </h2>

      <div class="main-cards">
        <ion-card class="metric-card temperature-card" [ngClass]="getTemperatureColor(currentReading.temperature)">
          <ion-card-content>
            <div class="metric-icon">
              <ion-icon name="thermometer-outline"></ion-icon>
            </div>
            <div class="metric-value">
              {{ currentReading.temperature.toFixed(1) }}ºC
            </div>
            <div class="metric-label">Temperatura</div>
          </ion-card-content>
        </ion-card>

        <ion-card class="metric-card humidity-card" [ngClass]="getHumidityColor(currentReading.humidity)">
          <ion-card-content>
            <div class="metric-icon">
              <ion-icon name="water-outline"></ion-icon>
            </div>
            <div class="metric-value">
              {{ currentReading.humidity.toFixed(1) }}%
            </div>
            <div class="metric-label">Umidade</div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <div class="stats-section" *ngIf="todayStats">
      <h2 class="section-title">
        <ion-icon name="refresh-outline"></ion-icon>
        Estatísticas de Hoje
      </h2>

      <ion-card class="stats-card">
        <ion-card-header>
          <ion-card-title>Resumo do Dia</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-label">Total de Leituras</div>
              <div class="stat-value">{{ todayStats.count }}</div>
            </div>
          </div>

          <div class="stats-divider"></div>

          <h3 class="stats-subtitle">Temperatura</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-label">Média</div>
              <div class="stat-value">{{ todayStats.avgTemp.toFixed(1) }}ºC</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Mínima</div>
              <div class="stat-value">{{ todayStats.minTemp.toFixed(1) }}ºC</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Máxima</div>
              <div class="stat-value">{{ todayStats.maxTemp.toFixed(1) }}ºC</div>
            </div>
          </div>

          <div class="stats-divider"></div>

          <h3 class="stats-subtitle">Umidade</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-label">Média</div>
              <div class="stat-value">{{ todayStats.avgHumidity.toFixed(1) }}%</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Mínima</div>
              <div class="stat-value">{{ todayStats.minHumidity.toFixed(1) }}%</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">Máxima</div>
              <div class="stat-value">{{ todayStats.maxHumidity.toFixed(1) }}%</div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <ng-template #noData>
      <div class="no-data">
        <ion-icon name="cloud-outline" class="no-data-icon"></ion-icon>
        <h3>Aguardando Dados</h3>
        <p>Conecte-se ao MQTT para receber leituras em tempo real</p>
      </div>
    </ng-template>
  </div>
</ion-content>